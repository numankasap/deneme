name: LGS Soru Üretici Bot

on:
  workflow_dispatch:
    inputs:
      kazanim_ids:
        description: 'Kazanım ID listesi veya "auto"'
        default: 'auto'
      count:
        description: 'Her kazanım için soru sayısı'
        default: '5'
      difficulty:
        description: 'Zorluk seviyesi'
        default: 'orta'
        type: choice
        options: [kolay, orta, zor, karisik]
      topic_group:
        description: 'Konu grubu'
        default: 'all'
        type: choice
        options: [all, sayilar_islemler, cebir, geometri, veri_isleme, olasilik]

  schedule:
    - cron: '0 9 * * 1'

env:
  SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
  SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
  GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install
        run: pip install -r lgs_soru_uretici_requirements.txt
      
      - name: Generate
        run: |
          python lgs_soru_uretici.py \
            -k "${{ inputs.kazanim_ids || 'auto' }}" \
            -n "${{ inputs.count || '5' }}" \
            -d "${{ inputs.difficulty || 'orta' }}" \
            -t "${{ inputs.topic_group || 'all' }}"
      
      - uses: actions/upload-artifact@v4
        with:
          name: report-${{ github.run_number }}
          path: reports/
