# Geometry Bot v4.0 Workflow - Hibrit Sistem
# ============================================
# Cairo + Gemini AI Image Generation
# 
# Stratejiler:
#   - cairo_only: Sadece programatik Ã§izim (hÄ±zlÄ±, gÃ¼venilir)
#   - ai_only: Sadece Gemini AI gÃ¶rsel Ã¼retimi
#   - hybrid: KarmaÅŸÄ±k ÅŸekillerde AI, basit ÅŸekillerde Cairo
#   - ai_first: Ã–nce AI dene, baÅŸarÄ±sÄ±z olursa Cairo
#
# GÃ¼nde 3 kez Ã§alÄ±ÅŸÄ±r (08:00, 14:00, 20:00 UTC+3)

name: Geometry Bot v4.0

on:
  # Manuel tetikleme
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Test modu (5 soru)'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'
      batch_size:
        description: 'Ä°ÅŸlenecek soru sayÄ±sÄ± (1-10)'
        required: false
        default: '10'
        type: string
      gemini_model:
        description: 'Gemini Analiz Modeli'
        required: false
        default: 'gemini-2.0-flash-exp'
        type: choice
        options:
          - 'gemini-2.0-flash-exp'
          - 'gemini-2.5-flash'
          - 'gemini-1.5-flash'
      image_strategy:
        description: 'GÃ¶rsel Ãœretim Stratejisi'
        required: false
        default: 'hybrid'
        type: choice
        options:
          - 'cairo_only'
          - 'ai_only'
          - 'hybrid'
          - 'ai_first'
          
  # ZamanlanmÄ±ÅŸ Ã§alÄ±ÅŸma (UTC saatleri - TÃ¼rkiye iÃ§in +3)
  schedule:
    # 05:00 UTC = 08:00 TR
    - cron: '0 5 * * *'
    # 11:00 UTC = 14:00 TR
    - cron: '0 11 * * *'
    # 17:00 UTC = 20:00 TR
     - cron: '0 17 * * *'

jobs:
  generate-geometry-visuals:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
      
      - name: ðŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ðŸ“¦ Install system dependencies (Cairo)
        run: |
          sudo apt-get update
          sudo apt-get install -y libcairo2-dev pkg-config python3-dev
      
      - name: ðŸ“¦ Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r geometry_requirements.txt
      
      - name: ðŸŽ¨ Run Geometry Bot v4.0
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GEMINI_MODEL: ${{ github.event.inputs.gemini_model || 'gemini-2.0-flash-exp' }}
          IMAGE_STRATEGY: ${{ github.event.inputs.image_strategy || 'hybrid' }}
          TEST_MODE: ${{ github.event.inputs.test_mode || 'false' }}
          BATCH_SIZE: ${{ github.event.inputs.batch_size || '10' }}
        run: |
          echo "ðŸš€ Geometri Bot v4.0 BaÅŸlatÄ±lÄ±yor..."
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ“… Tarih: $(date)"
          echo "ðŸ”§ Test Modu: $TEST_MODE"
          echo "ðŸ“Š Batch Boyutu: $BATCH_SIZE soru"
          echo "ðŸ¤– Gemini Model: $GEMINI_MODEL"
          echo "ðŸŽ¨ Image Strategy: $IMAGE_STRATEGY"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          python geometry_bot.py
      
      - name: ðŸ“Š Job Summary
        if: always()
        run: |
          echo "## ðŸŽ¨ Geometry Bot v4.0 Ã‡alÄ±ÅŸmasÄ±" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### KonfigÃ¼rasyon" >> $GITHUB_STEP_SUMMARY
          echo "| Parametre | DeÄŸer |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ“… Tarih | $(date) |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ”§ Test Modu | ${{ github.event.inputs.test_mode || 'false' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ“Š Batch | ${{ github.event.inputs.batch_size || '10' }} soru |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ¤– Model | ${{ github.event.inputs.gemini_model || 'gemini-2.0-flash-exp' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸŽ¨ Strateji | ${{ github.event.inputs.image_strategy || 'hybrid' }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Strateji AÃ§Ä±klamalarÄ±" >> $GITHUB_STEP_SUMMARY
          echo "- **cairo_only**: Sadece programatik Ã§izim (hÄ±zlÄ±, gÃ¼venilir)" >> $GITHUB_STEP_SUMMARY
          echo "- **ai_only**: Sadece Gemini AI gÃ¶rsel Ã¼retimi" >> $GITHUB_STEP_SUMMARY
          echo "- **hybrid**: KarmaÅŸÄ±k ÅŸekillerde AI, basit ÅŸekillerde Cairo" >> $GITHUB_STEP_SUMMARY
          echo "- **ai_first**: Ã–nce AI dene, baÅŸarÄ±sÄ±z olursa Cairo fallback" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Detaylar iÃ§in workflow loglarÄ±nÄ± kontrol edin." >> $GITHUB_STEP_SUMMARY
